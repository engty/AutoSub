# AutoSub Clashæ™ºèƒ½é…ç½®ç”Ÿæˆå™¨ - å¼€å‘æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | è¯´æ˜ |
|------|------|------|------|
| v1.0 | 2025-01-04 | AutoSub Team | åˆå§‹ç‰ˆæœ¬ |

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åœ¨AutoSubç°æœ‰è®¢é˜…åœ°å€é‡‡é›†åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå¢åŠ **è®¢é˜…å†…å®¹è§£æ â†’ èŠ‚ç‚¹æµ‹é€Ÿ â†’ æ™ºèƒ½åˆ†ç±» â†’ Clashé…ç½®ç”Ÿæˆ**çš„å®Œæ•´æµç¨‹ï¼Œå®ç°å…¨è‡ªåŠ¨åŒ–çš„Clashé…ç½®æ–‡ä»¶ç®¡ç†ã€‚

### æ ¸å¿ƒä»·å€¼

- âœ… **è‡ªåŠ¨åŒ–**: ä»è®¢é˜…åœ°å€åˆ°å¯ç”¨Clashé…ç½®ï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–
- âœ… **æ™ºèƒ½åŒ–**: AIé©±åŠ¨çš„èŠ‚ç‚¹å‘½åä¼˜åŒ–å’Œåˆ†ç±»
- âœ… **å¯é æ€§**: èŠ‚ç‚¹æµ‹é€Ÿè¿‡æ»¤ï¼Œåªä¿ç•™å¯ç”¨èŠ‚ç‚¹
- âœ… **æ˜“ç”¨æ€§**: ä¸€é”®ç”Ÿæˆï¼Œå¼€ç®±å³ç”¨

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AutoSub ç°æœ‰åŠŸèƒ½                               â”‚
â”‚  â€¢ è‡ªåŠ¨ç™»å½•VPNç«™ç‚¹                                                â”‚
â”‚  â€¢ æå–è®¢é˜…åœ°å€                                                   â”‚
â”‚  â€¢ ä¿å­˜åˆ° config.yaml                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ–°å¢ã€‘é˜¶æ®µ1: è®¢é˜…å†…å®¹ä¸‹è½½ä¸è§£æ                                â”‚
â”‚                                                                   â”‚
â”‚  è¾“å…¥: è®¢é˜…åœ°å€ (URL)                                             â”‚
â”‚  å¤„ç†:                                                            â”‚
â”‚    1. HTTP GET è¯·æ±‚ä¸‹è½½è®¢é˜…å†…å®¹                                   â”‚
â”‚    2. è‡ªåŠ¨è¯†åˆ«æ ¼å¼ (Clash YAML / Base64 / V2Ray JSON)           â”‚
â”‚    3. è§£æèŠ‚ç‚¹åˆ—è¡¨ï¼Œæå–å…³é”®ä¿¡æ¯                                  â”‚
â”‚  è¾“å‡º: ProxyNode[] (èŠ‚ç‚¹æ•°ç»„)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ–°å¢ã€‘é˜¶æ®µ2: èŠ‚ç‚¹å¯ç”¨æ€§æµ‹è¯•ä¸æµ‹é€Ÿ                              â”‚
â”‚                                                                   â”‚
â”‚  è¾“å…¥: ProxyNode[] (å¾…æµ‹èŠ‚ç‚¹)                                     â”‚
â”‚  å¤„ç†:                                                            â”‚
â”‚    1. å¹¶å‘HTTPå»¶è¿Ÿæµ‹è¯• (http://www.gstatic.com/generate_204)   â”‚
â”‚    2. å¯ç”¨æ€§æ£€æµ‹ (è¿‡æ»¤è¿æ¥å¤±è´¥çš„èŠ‚ç‚¹)                             â”‚
â”‚    3. å»¶è¿Ÿæ’åº (ä»å¿«åˆ°æ…¢)                                         â”‚
â”‚    4. [å¯é€‰] å¸¦å®½æµ‹é€Ÿ (Cloudflare/Speedtest.net)                â”‚
â”‚  è¾“å‡º: SpeedTestResult[] (æµ‹é€Ÿç»“æœ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ–°å¢ã€‘é˜¶æ®µ3: èŠ‚ç‚¹æ™ºèƒ½åˆ†ç±»ä¸å½’æ¡£                                â”‚
â”‚                                                                   â”‚
â”‚  è¾“å…¥: ProxyNode[] + SpeedTestResult[]                          â”‚
â”‚  å¤„ç†:                                                            â”‚
â”‚    1. åœ°åŒºåˆ†ç±» (é¦™æ¸¯/æ–°åŠ å¡/ç¾å›½/æ—¥æœ¬/...)                        â”‚
â”‚    2. é€Ÿåº¦åˆ†çº§ (é«˜é€Ÿ<100ms / ä¸­é€Ÿ<300ms / ä½é€Ÿ>300ms)            â”‚
â”‚    3. åè®®åˆ†ç±» (vmess/trojan/ss/ssr)                             â”‚
â”‚    4. [å¯é€‰] AIèŠ‚ç‚¹å‘½åä¼˜åŒ–                                       â”‚
â”‚  è¾“å‡º: åˆ†ç±»åçš„èŠ‚ç‚¹ç»„                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€æ–°å¢ã€‘é˜¶æ®µ4: Clashé…ç½®æ–‡ä»¶ç”Ÿæˆ                                 â”‚
â”‚                                                                   â”‚
â”‚  è¾“å…¥: åˆ†ç±»åçš„èŠ‚ç‚¹ç»„                                             â”‚
â”‚  å¤„ç†:                                                            â”‚
â”‚    1. åˆå¹¶æ‰€æœ‰ç«™ç‚¹çš„å¯ç”¨èŠ‚ç‚¹                                      â”‚
â”‚    2. ç”Ÿæˆç­–ç•¥ç»„ (è‡ªåŠ¨é€‰æ‹©/æ‰‹åŠ¨é€‰æ‹©/æ•…éšœè½¬ç§»/è´Ÿè½½å‡è¡¡)             â”‚
â”‚    3. é…ç½®è§„åˆ™é›† (å»å¹¿å‘Š/æµåª’ä½“åˆ†æµ/å›½å†…ç›´è¿)                      â”‚
â”‚    4. ç”Ÿæˆå®Œæ•´ Clash YAML é…ç½®                                    â”‚
â”‚  è¾“å‡º: clash.yaml é…ç½®æ–‡ä»¶                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å‘½ä»¤å±‚                                â”‚
â”‚  CLI: autosub clash:generate [options]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚                                 â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SubscriptionParserâ”‚  â”‚ NodeSpeedTester  â”‚  â”‚NodeClassifierâ”‚  â”‚
â”‚  â”‚  è®¢é˜…è§£æå™¨        â”‚  â”‚   èŠ‚ç‚¹æµ‹é€Ÿå™¨      â”‚  â”‚  èŠ‚ç‚¹åˆ†ç±»å™¨   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ClashConfigGenerator                         â”‚  â”‚
â”‚  â”‚              Clashé…ç½®ç”Ÿæˆå™¨                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å·¥å…·/æœåŠ¡å±‚                                â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  axios   â”‚  â”‚ js-yaml  â”‚  â”‚  logger  â”‚  â”‚  AI Service  â”‚   â”‚
â”‚  â”‚ HTTPå®¢æˆ·ç«¯â”‚  â”‚ YAMLè§£æ â”‚  â”‚  æ—¥å¿—     â”‚  â”‚  AIå¢å¼º      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### æ¨¡å—1: è®¢é˜…å†…å®¹è§£æå™¨ (SubscriptionParser)

#### åŠŸèƒ½æè¿°

å°†è®¢é˜…åœ°å€è¿”å›çš„å†…å®¹è§£æä¸ºç»Ÿä¸€çš„èŠ‚ç‚¹æ•°æ®ç»“æ„ã€‚

#### æ ¸å¿ƒæ¥å£

```typescript
// src/subscription/subscription-parser.ts

/**
 * èŠ‚ç‚¹ä¿¡æ¯æ¥å£ï¼ˆç»Ÿä¸€æ•°æ®ç»“æ„ï¼‰
 */
export interface ProxyNode {
  name: string;           // èŠ‚ç‚¹åç§°
  type: string;           // åè®®ç±»å‹: vmess/trojan/ss/ssr/http/socks5
  server: string;         // æœåŠ¡å™¨åœ°å€
  port: number;           // ç«¯å£å·

  // è®¤è¯ä¿¡æ¯
  password?: string;      // å¯†ç  (ss/ssr/http)
  uuid?: string;          // UUID (vmess/trojan)

  // åŠ å¯†ä¸åè®®
  cipher?: string;        // åŠ å¯†æ–¹å¼ (ss/ssr)
  protocol?: string;      // åè®® (ssr)

  // ä¼ è¾“å±‚é…ç½®
  network?: string;       // ä¼ è¾“åè®®: tcp/ws/grpc/h2
  tls?: boolean;          // æ˜¯å¦å¯ç”¨TLS
  sni?: string;           // SNIåŸŸå

  // VMessç‰¹æœ‰
  alterId?: number;       // VMess alterId

  // WebSocketé…ç½®
  wsPath?: string;        // WebSocketè·¯å¾„
  wsHeaders?: Record<string, string>; // WebSocketè¯·æ±‚å¤´

  // å…¶ä»–å…ƒæ•°æ®
  udp?: boolean;          // æ˜¯å¦æ”¯æŒUDP
  skipCertVerify?: boolean; // æ˜¯å¦è·³è¿‡è¯ä¹¦éªŒè¯
}

/**
 * è®¢é˜…è§£æç»“æœ
 */
export interface ParseResult {
  format: 'clash' | 'base64' | 'v2ray' | 'unknown';
  nodes: ProxyNode[];
  originalConfig?: any;    // åŸå§‹é…ç½®ï¼ˆç”¨äºé«˜çº§ç”¨æˆ·ï¼‰
  parseTime: Date;
  totalNodes: number;
}

/**
 * è®¢é˜…å†…å®¹è§£æå™¨
 */
export class SubscriptionParser {

  /**
   * ä¸»å…¥å£ï¼šè§£æè®¢é˜…å†…å®¹
   * @param subscriptionContent - è®¢é˜…åœ°å€è¿”å›çš„åŸå§‹å†…å®¹
   * @returns è§£æç»“æœ
   */
  async parse(subscriptionContent: string): Promise<ParseResult>;

  /**
   * æ ¼å¼æ£€æµ‹
   */
  private detectFormat(content: string): ParseResult['format'];

  /**
   * è§£æClash YAMLæ ¼å¼
   */
  private parseClashYAML(content: string): ParseResult;

  /**
   * è§£æBase64ç¼–ç æ ¼å¼
   */
  private parseBase64(content: string): ParseResult;

  /**
   * è§£æV2Ray JSONæ ¼å¼
   */
  private parseV2RayJSON(content: string): ParseResult;

  /**
   * è§£æVMess URI
   */
  private parseVMessURI(uri: string): ProxyNode;

  /**
   * è§£æTrojan URI
   */
  private parseTrojanURI(uri: string): ProxyNode;

  /**
   * è§£æShadowsocks URI
   */
  private parseSSURI(uri: string): ProxyNode;

  /**
   * è§£æShadowsocksR URI
   */
  private parseSSRURI(uri: string): ProxyNode;
}
```

#### æ”¯æŒçš„è®¢é˜…æ ¼å¼

| æ ¼å¼ | è¯†åˆ«ç‰¹å¾ | è§£ææ–¹æ³• | ä¼˜å…ˆçº§ |
|------|---------|---------|-------|
| Clash YAML | `proxies:` æˆ– `proxy-groups:` | js-yamlè§£æ | é«˜ |
| Base64ç¼–ç  | çº¯Base64å­—ç¬¦ä¸² | è§£ç åæŒ‰è¡Œåˆ†å‰²URI | ä¸­ |
| V2Ray JSON | `{"outbounds":...}` | JSON.parse | ä¸­ |

#### å®ç°ç»†èŠ‚

##### 1. æ ¼å¼æ£€æµ‹é€»è¾‘

```typescript
private detectFormat(content: string): ParseResult['format'] {
  // å»é™¤é¦–å°¾ç©ºæ ¼
  const trimmed = content.trim();

  // ä¼˜å…ˆçº§1: Clash YAMLæ ¼å¼
  if (trimmed.includes('proxies:') || trimmed.includes('proxy-groups:')) {
    return 'clash';
  }

  // ä¼˜å…ˆçº§2: Base64ç¼–ç 
  // ç‰¹å¾: åªåŒ…å« A-Za-z0-9+/= å­—ç¬¦ï¼Œä¸”é•¿åº¦è¶³å¤Ÿé•¿
  if (/^[A-Za-z0-9+/=\s]+$/.test(trimmed) && trimmed.length > 50) {
    return 'base64';
  }

  // ä¼˜å…ˆçº§3: V2Ray JSON
  try {
    const json = JSON.parse(trimmed);
    if (json.outbounds || json.vnext || json.inbounds) {
      return 'v2ray';
    }
  } catch {
    // ä¸æ˜¯JSONï¼Œç»§ç»­æ£€æµ‹
  }

  return 'unknown';
}
```

##### 2. Clash YAMLè§£æ

```typescript
private parseClashYAML(content: string): ParseResult {
  const config = yaml.load(content) as any;

  if (!config.proxies || !Array.isArray(config.proxies)) {
    throw new Error('æ— æ•ˆçš„Clashé…ç½®ï¼šç¼ºå°‘proxieså­—æ®µ');
  }

  const nodes: ProxyNode[] = config.proxies.map((proxy: any) => ({
    name: proxy.name,
    type: proxy.type,
    server: proxy.server,
    port: proxy.port,
    password: proxy.password,
    uuid: proxy.uuid,
    cipher: proxy.cipher,
    network: proxy.network,
    tls: proxy.tls,
    sni: proxy.sni,
    wsPath: proxy['ws-path'] || proxy['ws-opts']?.path,
    wsHeaders: proxy['ws-headers'] || proxy['ws-opts']?.headers,
    alterId: proxy.alterId,
    udp: proxy.udp,
    skipCertVerify: proxy['skip-cert-verify'],
  }));

  return {
    format: 'clash',
    nodes,
    originalConfig: config,
    parseTime: new Date(),
    totalNodes: nodes.length
  };
}
```

##### 3. Base64è§£æ

```typescript
private parseBase64(content: string): ParseResult {
  // è§£ç Base64
  const decoded = Buffer.from(content.trim(), 'base64').toString('utf-8');

  // æŒ‰è¡Œåˆ†å‰²
  const lines = decoded.split('\n').filter(line => line.trim());

  const nodes: ProxyNode[] = [];

  for (const line of lines) {
    try {
      // æ ¹æ®URIåè®®å¤´åˆ†å‘åˆ°å¯¹åº”è§£æå™¨
      if (line.startsWith('vmess://')) {
        nodes.push(this.parseVMessURI(line));
      } else if (line.startsWith('trojan://')) {
        nodes.push(this.parseTrojanURI(line));
      } else if (line.startsWith('ss://')) {
        nodes.push(this.parseSSURI(line));
      } else if (line.startsWith('ssr://')) {
        nodes.push(this.parseSSRURI(line));
      }
    } catch (error) {
      logger.warn(`è§£æèŠ‚ç‚¹å¤±è´¥: ${line.substring(0, 50)}...`, error);
    }
  }

  return {
    format: 'base64',
    nodes,
    parseTime: new Date(),
    totalNodes: nodes.length
  };
}
```

##### 4. VMess URIè§£æ

```typescript
private parseVMessURI(uri: string): ProxyNode {
  // vmess://Base64EncodedJSON
  const base64Content = uri.replace('vmess://', '');
  const jsonStr = Buffer.from(base64Content, 'base64').toString('utf-8');
  const config = JSON.parse(jsonStr);

  return {
    name: config.ps || config.name || `${config.add}:${config.port}`,
    type: 'vmess',
    server: config.add,
    port: parseInt(config.port),
    uuid: config.id,
    alterId: parseInt(config.aid || '0'),
    cipher: config.scy || 'auto',
    network: config.net || 'tcp',
    tls: config.tls === 'tls',
    sni: config.sni || config.host,
    wsPath: config.path,
    wsHeaders: config.host ? { Host: config.host } : undefined,
  };
}
```

##### 5. Trojan URIè§£æ

```typescript
private parseTrojanURI(uri: string): ProxyNode {
  // trojan://password@server:port?sni=xxx&type=ws&path=/path#NodeName
  const url = new URL(uri);

  return {
    name: decodeURIComponent(url.hash.substring(1)) || `${url.hostname}:${url.port}`,
    type: 'trojan',
    server: url.hostname,
    port: parseInt(url.port),
    password: url.username,
    sni: url.searchParams.get('sni') || url.hostname,
    network: url.searchParams.get('type') || 'tcp',
    wsPath: url.searchParams.get('path') || undefined,
    tls: true, // Trojanåè®®å¼ºåˆ¶TLS
    skipCertVerify: url.searchParams.get('allowInsecure') === '1',
  };
}
```

---

### æ¨¡å—2: èŠ‚ç‚¹æµ‹é€Ÿå™¨ (NodeSpeedTester)

#### åŠŸèƒ½æè¿°

å¯¹è§£æå‡ºçš„èŠ‚ç‚¹è¿›è¡Œå¯ç”¨æ€§æµ‹è¯•å’Œå»¶è¿Ÿæµ‹é€Ÿï¼Œè¿‡æ»¤ä¸å¯ç”¨èŠ‚ç‚¹ã€‚

#### æ ¸å¿ƒæ¥å£

```typescript
// src/subscription/node-speedtest.ts

/**
 * æµ‹é€Ÿç»“æœ
 */
export interface SpeedTestResult {
  nodeName: string;
  delay: number;           // å»¶è¿Ÿ(ms) -1è¡¨ç¤ºä¸å¯ç”¨
  bandwidth?: number;      // å¸¦å®½(MB/s) ä»…é«˜çº§æµ‹é€Ÿ
  jitter?: number;         // æŠ–åŠ¨(ms) ä»…é«˜çº§æµ‹é€Ÿ
  available: boolean;      // æ˜¯å¦å¯ç”¨
  testTime: Date;
  errorMessage?: string;   // é”™è¯¯ä¿¡æ¯ï¼ˆä¸å¯ç”¨æ—¶ï¼‰
}

/**
 * æµ‹é€Ÿé…ç½®
 */
export interface SpeedTestOptions {
  timeout?: number;        // è¶…æ—¶æ—¶é—´(ms) é»˜è®¤5000
  concurrency?: number;    // å¹¶å‘æ•° é»˜è®¤10
  testUrl?: string;        // æµ‹è¯•URL é»˜è®¤Google 204
  retries?: number;        // é‡è¯•æ¬¡æ•° é»˜è®¤0
}

/**
 * èŠ‚ç‚¹æµ‹é€Ÿå™¨
 */
export class NodeSpeedTester {

  /**
   * æµ‹è¯•å•ä¸ªèŠ‚ç‚¹
   */
  async testNode(
    node: ProxyNode,
    options?: SpeedTestOptions
  ): Promise<SpeedTestResult>;

  /**
   * æ‰¹é‡æµ‹è¯•èŠ‚ç‚¹ï¼ˆå¸¦å¹¶å‘æ§åˆ¶ï¼‰
   */
  async testNodes(
    nodes: ProxyNode[],
    options?: SpeedTestOptions
  ): Promise<SpeedTestResult[]>;

  /**
   * è¿‡æ»¤å¯ç”¨èŠ‚ç‚¹
   */
  filterAvailableNodes(
    nodes: ProxyNode[],
    results: SpeedTestResult[]
  ): ProxyNode[];

  /**
   * æŒ‰å»¶è¿Ÿæ’åº
   */
  sortByDelay(results: SpeedTestResult[]): SpeedTestResult[];
}
```

#### å®ç°ç­–ç•¥

##### ç­–ç•¥1: HTTP 204å»¶è¿Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**: è½»é‡ã€æ— ä¾èµ–ã€è·¨å¹³å°
**ç¼ºç‚¹**: ä»…èƒ½æµ‹å»¶è¿Ÿï¼Œæ— æ³•æµ‹å¸¦å®½

```typescript
async testNode(node: ProxyNode, options?: SpeedTestOptions): Promise<SpeedTestResult> {
  const testUrl = options?.testUrl || 'http://www.gstatic.com/generate_204';
  const timeout = options?.timeout || 5000;

  const startTime = Date.now();

  try {
    // æ³¨æ„: å¯¹äºvmess/trojanç­‰å¤æ‚åè®®ï¼Œéœ€è¦å…ˆå¯åŠ¨Clashä»£ç†
    // ç®€å•åè®®(http/socks5/ss)å¯ä»¥ç›´æ¥ä½¿ç”¨ä»£ç†Agent

    const response = await axios.get(testUrl, {
      timeout,
      validateStatus: (status) => status === 204 || status === 200,
    });

    const delay = Date.now() - startTime;

    return {
      nodeName: node.name,
      delay,
      available: true,
      testTime: new Date()
    };

  } catch (error) {
    return {
      nodeName: node.name,
      delay: -1,
      available: false,
      testTime: new Date(),
      errorMessage: error.message
    };
  }
}
```

##### ç­–ç•¥2: Clash Meta APIæµ‹é€Ÿï¼ˆé«˜çº§ï¼‰

**ä¼˜ç‚¹**: æ”¯æŒæ‰€æœ‰åè®®ã€å‡†ç¡®
**ç¼ºç‚¹**: éœ€è¦å¯åŠ¨Clashè¿›ç¨‹

```typescript
async testWithClashMeta(nodes: ProxyNode[]): Promise<SpeedTestResult[]> {
  // 1. ç”Ÿæˆä¸´æ—¶Clashé…ç½®
  const tempConfig = this.generateTempClashConfig(nodes);
  const configPath = '/tmp/autosub-test-config.yaml';
  fs.writeFileSync(configPath, yaml.dump(tempConfig));

  // 2. å¯åŠ¨Clash Metaè¿›ç¨‹
  const clashProcess = spawn('clash-meta', ['-f', configPath, '-d', '/tmp/clash-test']);

  // ç­‰å¾…Clashå¯åŠ¨
  await new Promise(resolve => setTimeout(resolve, 2000));

  try {
    // 3. é€šè¿‡Clash APIæµ‹é€Ÿ
    const results: SpeedTestResult[] = [];

    for (const node of nodes) {
      const result = await axios.get(`http://127.0.0.1:9090/proxies/${node.name}/delay`, {
        params: {
          url: 'http://www.gstatic.com/generate_204',
          timeout: 5000
        }
      });

      results.push({
        nodeName: node.name,
        delay: result.data.delay,
        available: result.data.delay > 0,
        testTime: new Date()
      });
    }

    return results;

  } finally {
    // 4. å…³é—­Clashè¿›ç¨‹
    clashProcess.kill();
  }
}
```

#### å¹¶å‘æ§åˆ¶å®ç°

```typescript
async testNodes(
  nodes: ProxyNode[],
  options?: SpeedTestOptions
): Promise<SpeedTestResult[]> {

  const concurrency = options?.concurrency || 10;
  const results: SpeedTestResult[] = [];

  logger.info(`å¼€å§‹æµ‹é€Ÿ ${nodes.length} ä¸ªèŠ‚ç‚¹ (å¹¶å‘: ${concurrency})`);

  // åˆ†æ‰¹å¹¶å‘æµ‹è¯•
  for (let i = 0; i < nodes.length; i += concurrency) {
    const batch = nodes.slice(i, i + concurrency);

    const batchResults = await Promise.all(
      batch.map(node => this.testNode(node, options))
    );

    results.push(...batchResults);

    const progress = Math.round((results.length / nodes.length) * 100);
    logger.info(`æµ‹é€Ÿè¿›åº¦: ${results.length}/${nodes.length} (${progress}%)`);
  }

  // æŒ‰å»¶è¿Ÿæ’åº
  return this.sortByDelay(results);
}

sortByDelay(results: SpeedTestResult[]): SpeedTestResult[] {
  return results.sort((a, b) => {
    // ä¸å¯ç”¨èŠ‚ç‚¹æ’åˆ°æœ€å
    if (!a.available) return 1;
    if (!b.available) return -1;

    // æŒ‰å»¶è¿Ÿå‡åºæ’åº
    return a.delay - b.delay;
  });
}
```

---

### æ¨¡å—3: èŠ‚ç‚¹åˆ†ç±»å™¨ (NodeClassifier)

#### åŠŸèƒ½æè¿°

å°†èŠ‚ç‚¹æŒ‰åœ°åŒºã€é€Ÿåº¦ã€åè®®ç­‰ç»´åº¦åˆ†ç±»ï¼Œä¾¿äºç”Ÿæˆç­–ç•¥ç»„ã€‚

#### æ ¸å¿ƒæ¥å£

```typescript
// src/subscription/node-classifier.ts

/**
 * èŠ‚ç‚¹åˆ†ç±»å™¨
 */
export class NodeClassifier {

  /**
   * æŒ‰åœ°åŒºåˆ†ç»„
   */
  classifyByRegion(nodes: ProxyNode[]): Map<string, ProxyNode[]>;

  /**
   * æŒ‰é€Ÿåº¦åˆ†çº§
   */
  classifyBySpeed(
    nodes: ProxyNode[],
    speedResults: SpeedTestResult[]
  ): {
    highSpeed: ProxyNode[];    // <100ms
    mediumSpeed: ProxyNode[];  // 100-300ms
    lowSpeed: ProxyNode[];     // >300ms
  };

  /**
   * æŒ‰åè®®åˆ†ç±»
   */
  classifyByProtocol(nodes: ProxyNode[]): Map<string, ProxyNode[]>;

  /**
   * AIä¼˜åŒ–èŠ‚ç‚¹å‘½å
   */
  async optimizeNodeNames(nodes: ProxyNode[]): Promise<ProxyNode[]>;

  /**
   * æ£€æµ‹èŠ‚ç‚¹åœ°åŒº
   */
  private detectRegion(nodeName: string): string;
}
```

#### åœ°åŒºæ£€æµ‹å®ç°

```typescript
private detectRegion(nodeName: string): string {
  // åœ°åŒºå…³é”®è¯æ˜ å°„è¡¨
  const regionKeywords: Record<string, string[]> = {
    'é¦™æ¸¯': ['é¦™æ¸¯', 'HK', 'Hong Kong', 'HongKong', 'æ¸¯', 'HGC', 'HKBN', 'PCCW'],
    'å°æ¹¾': ['å°æ¹¾', 'TW', 'Taiwan', 'å°', 'CHT', 'Hinet'],
    'æ–°åŠ å¡': ['æ–°åŠ å¡', 'SG', 'Singapore', 'ç‹®åŸ', 'å¡'],
    'æ—¥æœ¬': ['æ—¥æœ¬', 'JP', 'Japan', 'ä¸œäº¬', 'Tokyo', 'å¤§é˜ª', 'Osaka'],
    'éŸ©å›½': ['éŸ©å›½', 'KR', 'Korea', 'é¦–å°”', 'Seoul'],
    'ç¾å›½': ['ç¾å›½', 'US', 'USA', 'America', 'æ´›æ‰çŸ¶', 'LA', 'è¥¿é›…å›¾', 'Seattle', 'çº½çº¦', 'NY'],
    'è‹±å›½': ['è‹±å›½', 'UK', 'Britain', 'ä¼¦æ•¦', 'London'],
    'å¾·å›½': ['å¾·å›½', 'DE', 'Germany', 'æ³•å…°å…‹ç¦', 'Frankfurt'],
    'æ³•å›½': ['æ³•å›½', 'FR', 'France', 'å·´é»', 'Paris'],
    'åŠ æ‹¿å¤§': ['åŠ æ‹¿å¤§', 'CA', 'Canada', 'å¤šä¼¦å¤š', 'Toronto'],
    'æ¾³å¤§åˆ©äºš': ['æ¾³å¤§åˆ©äºš', 'AU', 'Australia', 'æ‚‰å°¼', 'Sydney'],
    'ä¿„ç½—æ–¯': ['ä¿„ç½—æ–¯', 'RU', 'Russia', 'è«æ–¯ç§‘', 'Moscow'],
    'å°åº¦': ['å°åº¦', 'IN', 'India', 'å­Ÿä¹°', 'Mumbai'],
    'å·´è¥¿': ['å·´è¥¿', 'BR', 'Brazil', 'åœ£ä¿ç½—', 'Sao Paulo'],
    'åœŸè€³å…¶': ['åœŸè€³å…¶', 'TR', 'Turkey', 'ä¼Šæ–¯å¦å¸ƒå°”', 'Istanbul'],
    'é˜¿æ ¹å»·': ['é˜¿æ ¹å»·', 'AR', 'Argentina'],
  };

  // æ£€æµ‹åŒ¹é…
  for (const [region, keywords] of Object.entries(regionKeywords)) {
    for (const keyword of keywords) {
      if (nodeName.includes(keyword)) {
        return region;
      }
    }
  }

  return 'å…¶ä»–';
}

classifyByRegion(nodes: ProxyNode[]): Map<string, ProxyNode[]> {
  const regionMap = new Map<string, ProxyNode[]>();

  for (const node of nodes) {
    const region = this.detectRegion(node.name);

    if (!regionMap.has(region)) {
      regionMap.set(region, []);
    }

    regionMap.get(region)!.push(node);
  }

  // æŒ‰èŠ‚ç‚¹æ•°é‡æ’åº
  return new Map(
    Array.from(regionMap.entries())
      .sort((a, b) => b[1].length - a[1].length)
  );
}
```

#### é€Ÿåº¦åˆ†çº§å®ç°

```typescript
classifyBySpeed(
  nodes: ProxyNode[],
  speedResults: SpeedTestResult[]
): {
  highSpeed: ProxyNode[];
  mediumSpeed: ProxyNode[];
  lowSpeed: ProxyNode[];
} {
  // æ„å»ºå»¶è¿Ÿæ˜ å°„è¡¨
  const delayMap = new Map(
    speedResults.map(r => [r.nodeName, r.delay])
  );

  const highSpeed: ProxyNode[] = [];
  const mediumSpeed: ProxyNode[] = [];
  const lowSpeed: ProxyNode[] = [];

  for (const node of nodes) {
    const delay = delayMap.get(node.name);

    // è·³è¿‡ä¸å¯ç”¨èŠ‚ç‚¹
    if (!delay || delay < 0) continue;

    if (delay < 100) {
      highSpeed.push(node);
    } else if (delay < 300) {
      mediumSpeed.push(node);
    } else {
      lowSpeed.push(node);
    }
  }

  return { highSpeed, mediumSpeed, lowSpeed };
}
```

#### AIèŠ‚ç‚¹å‘½åä¼˜åŒ–

```typescript
async optimizeNodeNames(nodes: ProxyNode[]): Promise<ProxyNode[]> {
  const aiService = getAIService();
  if (!aiService) {
    logger.warn('AIæœªå¯ç”¨ï¼Œè·³è¿‡èŠ‚ç‚¹å‘½åä¼˜åŒ–');
    return nodes;
  }

  // é™åˆ¶ä¼˜åŒ–æ•°é‡ï¼Œé¿å…APIè°ƒç”¨è¿‡å¤š
  const sampleSize = Math.min(nodes.length, 50);
  const sampleNodes = nodes.slice(0, sampleSize);

  const prompt = `ä¼˜åŒ–VPNèŠ‚ç‚¹å‘½åï¼Œä½¿å…¶æ›´æ¸…æ™°æ˜“è¯»ï¼š

åŸå§‹èŠ‚ç‚¹åï¼ˆå‰${sampleSize}ä¸ªï¼‰:
${sampleNodes.map((n, i) => `${i+1}. ${n.name}`).join('\n')}

ä¼˜åŒ–è§„åˆ™:
1. ç»Ÿä¸€æ ¼å¼ï¼šåœ°åŒº + [çº¿è·¯ç±»å‹] + ç¼–å·
2. ä¸­æ–‡ä¼˜å…ˆï¼Œä¿ç•™å…³é”®è‹±æ–‡ç¼©å†™(IPLC/IEPL)
3. å»é™¤å¤šä½™ç¬¦å·å’Œemoji
4. çº¿è·¯ç±»å‹: IPLC(å›½é™…ä¸“çº¿) / BGP(æ™®é€š) / CN2(ç”µä¿¡ä¼˜åŒ–)

ç¤ºä¾‹:
- "ğŸ‡­ğŸ‡°HK-IPLC-01 [100Mbps]" â†’ "é¦™æ¸¯ IPLC 01"
- "SG_Premium_Node_2" â†’ "æ–°åŠ å¡ BGP 02"

è¿”å›JSONæ•°ç»„:
[
  {"old": "åŸå§‹åç§°", "new": "ä¼˜åŒ–ååç§°"},
  ...
]`;

  try {
    const result = await aiService.chat(prompt);
    const mappings = JSON.parse(result);

    // åº”ç”¨å‘½åæ˜ å°„
    return nodes.map(node => {
      const mapping = mappings.find((m: any) => m.old === node.name);
      if (mapping) {
        logger.debug(`èŠ‚ç‚¹é‡å‘½å: ${node.name} â†’ ${mapping.new}`);
        return { ...node, name: mapping.new };
      }
      return node;
    });

  } catch (error) {
    logger.error('AIèŠ‚ç‚¹å‘½åä¼˜åŒ–å¤±è´¥:', error);
    return nodes; // å¤±è´¥æ—¶è¿”å›åŸå§‹èŠ‚ç‚¹
  }
}
```

---

### æ¨¡å—4: Clashé…ç½®ç”Ÿæˆå™¨ (ClashConfigGenerator)

#### åŠŸèƒ½æè¿°

å°†åˆ†ç±»åçš„èŠ‚ç‚¹ç”Ÿæˆå®Œæ•´çš„Clashé…ç½®æ–‡ä»¶ã€‚

#### æ ¸å¿ƒæ¥å£

```typescript
// src/subscription/clash-config-generator.ts

/**
 * Clashé…ç½®ç”Ÿæˆé€‰é¡¹
 */
export interface ClashConfigOptions {
  mode?: 'rule' | 'global' | 'direct';      // è¿è¡Œæ¨¡å¼
  port?: number;                             // HTTPä»£ç†ç«¯å£
  socksPort?: number;                        // SOCKS5ä»£ç†ç«¯å£
  allowLan?: boolean;                        // å…è®¸å±€åŸŸç½‘è¿æ¥
  logLevel?: 'info' | 'warning' | 'error' | 'debug' | 'silent';

  // ç­–ç•¥ç»„é…ç½®
  enableAutoSelect?: boolean;                // å¯ç”¨è‡ªåŠ¨é€‰æ‹©
  enableLoadBalance?: boolean;               // å¯ç”¨è´Ÿè½½å‡è¡¡
  enableFallback?: boolean;                  // å¯ç”¨æ•…éšœè½¬ç§»

  // è§„åˆ™é…ç½®
  enableAdBlock?: boolean;                   // å¯ç”¨å¹¿å‘Šæ‹¦æˆª
  enableStreamingRules?: boolean;            // å¯ç”¨æµåª’ä½“åˆ†æµ
  enableChinaDirect?: boolean;               // å¯ç”¨å›½å†…ç›´è¿

  // é«˜çº§é€‰é¡¹
  dns?: any;                                 // DNSé…ç½®
  customRules?: string[];                    // è‡ªå®šä¹‰è§„åˆ™
}

/**
 * Clashé…ç½®ç”Ÿæˆå™¨
 */
export class ClashConfigGenerator {

  /**
   * ç”Ÿæˆå®Œæ•´Clashé…ç½®
   */
  async generate(
    allNodes: ProxyNode[],
    speedResults: SpeedTestResult[],
    options?: ClashConfigOptions
  ): Promise<string>;

  /**
   * ç”Ÿæˆç­–ç•¥ç»„
   */
  private generateProxyGroups(
    regionGroups: Map<string, ProxyNode[]>,
    speedGroups: any,
    options?: ClashConfigOptions
  ): any[];

  /**
   * ç”Ÿæˆè§„åˆ™
   */
  private generateRules(options?: ClashConfigOptions): string[];

  /**
   * è·å–åœ°åŒºEmoji
   */
  private getRegionEmoji(region: string): string;
}
```

#### é…ç½®ç”Ÿæˆå®ç°

```typescript
async generate(
  allNodes: ProxyNode[],
  speedResults: SpeedTestResult[],
  options?: ClashConfigOptions
): Promise<string> {

  logger.info(`å¼€å§‹ç”ŸæˆClashé…ç½®ï¼Œå…± ${allNodes.length} ä¸ªèŠ‚ç‚¹`);

  // 1. è¿‡æ»¤å¯ç”¨èŠ‚ç‚¹
  const availableNodes = allNodes.filter(node => {
    const result = speedResults.find(r => r.nodeName === node.name);
    return result?.available === true;
  });

  logger.info(`å¯ç”¨èŠ‚ç‚¹: ${availableNodes.length}/${allNodes.length}`);

  if (availableNodes.length === 0) {
    throw new Error('æ²¡æœ‰å¯ç”¨èŠ‚ç‚¹ï¼Œæ— æ³•ç”Ÿæˆé…ç½®');
  }

  // 2. èŠ‚ç‚¹åˆ†ç±»
  const classifier = new NodeClassifier();
  const regionGroups = classifier.classifyByRegion(availableNodes);
  const speedGroups = classifier.classifyBySpeed(availableNodes, speedResults);

  // 3. æ„å»ºClashé…ç½®å¯¹è±¡
  const clashConfig: any = {
    // åŸºç¡€é…ç½®
    port: options?.port || 7890,
    'socks-port': options?.socksPort || 7891,
    'allow-lan': options?.allowLan || false,
    mode: options?.mode || 'rule',
    'log-level': options?.logLevel || 'info',
    'external-controller': '127.0.0.1:9090',

    // DNSé…ç½®
    dns: options?.dns || {
      enable: true,
      ipv6: false,
      'enhanced-mode': 'fake-ip',
      nameserver: [
        '223.5.5.5',
        '119.29.29.29'
      ],
      fallback: [
        'https://1.1.1.1/dns-query',
        'https://dns.google/dns-query'
      ]
    },

    // ä»£ç†èŠ‚ç‚¹
    proxies: availableNodes,

    // ç­–ç•¥ç»„
    'proxy-groups': this.generateProxyGroups(regionGroups, speedGroups, options),

    // è§„åˆ™
    rules: this.generateRules(options),
  };

  // 4. è½¬æ¢ä¸ºYAML
  const yamlContent = yaml.dump(clashConfig, {
    indent: 2,
    lineWidth: -1,
    noRefs: true
  });

  logger.info('Clashé…ç½®ç”ŸæˆæˆåŠŸ');

  return yamlContent;
}
```

#### ç­–ç•¥ç»„ç”Ÿæˆ

```typescript
private generateProxyGroups(
  regionGroups: Map<string, ProxyNode[]>,
  speedGroups: any,
  options?: ClashConfigOptions
): any[] {

  const groups: any[] = [];

  // 1. ä¸»é€‰æ‹©ç»„
  const mainProxies = [
    'DIRECT',
    'â™»ï¸ è‡ªåŠ¨é€‰æ‹©',
  ];

  // æ·»åŠ åœ°åŒºç»„
  for (const region of regionGroups.keys()) {
    const emoji = this.getRegionEmoji(region);
    mainProxies.push(`${emoji} ${region}`);
  }

  // æ·»åŠ é€Ÿåº¦ç»„
  if (speedGroups.highSpeed.length > 0) {
    mainProxies.push('âš¡ é«˜é€ŸèŠ‚ç‚¹');
  }

  groups.push({
    name: 'ğŸš€ èŠ‚ç‚¹é€‰æ‹©',
    type: 'select',
    proxies: mainProxies
  });

  // 2. è‡ªåŠ¨é€‰æ‹©ç»„ï¼ˆåŸºäºå»¶è¿Ÿï¼‰
  if (options?.enableAutoSelect !== false) {
    const autoNodes = speedGroups.highSpeed.length > 0
      ? speedGroups.highSpeed
      : speedGroups.mediumSpeed;

    if (autoNodes.length > 0) {
      groups.push({
        name: 'â™»ï¸ è‡ªåŠ¨é€‰æ‹©',
        type: 'url-test',
        proxies: autoNodes.map((n: ProxyNode) => n.name),
        url: 'http://www.gstatic.com/generate_204',
        interval: 300,
        tolerance: 50
      });
    }
  }

  // 3. è´Ÿè½½å‡è¡¡ç»„
  if (options?.enableLoadBalance && speedGroups.highSpeed.length > 2) {
    groups.push({
      name: 'âš–ï¸ è´Ÿè½½å‡è¡¡',
      type: 'load-balance',
      proxies: speedGroups.highSpeed.map((n: ProxyNode) => n.name),
      url: 'http://www.gstatic.com/generate_204',
      interval: 300
    });
  }

  // 4. æ•…éšœè½¬ç§»ç»„
  if (options?.enableFallback && speedGroups.highSpeed.length > 1) {
    groups.push({
      name: 'ğŸ”„ æ•…éšœè½¬ç§»',
      type: 'fallback',
      proxies: speedGroups.highSpeed.map((n: ProxyNode) => n.name),
      url: 'http://www.gstatic.com/generate_204',
      interval: 300
    });
  }

  // 5. é«˜é€ŸèŠ‚ç‚¹ç»„
  if (speedGroups.highSpeed.length > 0) {
    groups.push({
      name: 'âš¡ é«˜é€ŸèŠ‚ç‚¹',
      type: 'select',
      proxies: speedGroups.highSpeed.map((n: ProxyNode) => n.name)
    });
  }

  // 6. åœ°åŒºåˆ†ç»„
  for (const [region, nodes] of regionGroups) {
    const emoji = this.getRegionEmoji(region);

    groups.push({
      name: `${emoji} ${region}`,
      type: 'select',
      proxies: nodes.map(n => n.name)
    });
  }

  // 7. æµåª’ä½“åˆ†ç»„
  if (options?.enableStreamingRules !== false) {
    groups.push({
      name: 'ğŸ“º æµåª’ä½“',
      type: 'select',
      proxies: ['ğŸš€ èŠ‚ç‚¹é€‰æ‹©', ...mainProxies.slice(2)]
    });
  }

  // 8. å¹¿å‘Šæ‹¦æˆª
  if (options?.enableAdBlock !== false) {
    groups.push({
      name: 'ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',
      type: 'select',
      proxies: ['REJECT', 'DIRECT']
    });
  }

  // 9. å›½å†…ç›´è¿
  groups.push({
    name: 'ğŸ¯ å›½å†…ç›´è¿',
    type: 'select',
    proxies: ['DIRECT', 'ğŸš€ èŠ‚ç‚¹é€‰æ‹©']
  });

  // 10. æ¼ç½‘ä¹‹é±¼
  groups.push({
    name: 'ğŸŸ æ¼ç½‘ä¹‹é±¼',
    type: 'select',
    proxies: ['ğŸš€ èŠ‚ç‚¹é€‰æ‹©', 'DIRECT']
  });

  return groups;
}
```

#### è§„åˆ™ç”Ÿæˆ

```typescript
private generateRules(options?: ClashConfigOptions): string[] {
  const rules: string[] = [];

  // 1. å¹¿å‘Šæ‹¦æˆªè§„åˆ™
  if (options?.enableAdBlock !== false) {
    rules.push(
      // Googleå¹¿å‘Š
      'DOMAIN-SUFFIX,googlesyndication.com,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',
      'DOMAIN-SUFFIX,googleadservices.com,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',
      'DOMAIN-SUFFIX,doubleclick.net,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',

      // Facebookå¹¿å‘Š
      'DOMAIN-SUFFIX,facebook.com,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',
      'DOMAIN-SUFFIX,fbcdn.net,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',

      // å›½å†…å¹¿å‘Š
      'DOMAIN-SUFFIX,tanx.com,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª',
      'DOMAIN-SUFFIX,mmstat.com,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª'
    );
  }

  // 2. æµåª’ä½“åˆ†æµè§„åˆ™
  if (options?.enableStreamingRules !== false) {
    rules.push(
      // YouTube
      'DOMAIN-SUFFIX,youtube.com,ğŸ“º æµåª’ä½“',
      'DOMAIN-SUFFIX,googlevideo.com,ğŸ“º æµåª’ä½“',
      'DOMAIN-SUFFIX,ytimg.com,ğŸ“º æµåª’ä½“',

      // Netflix
      'DOMAIN-SUFFIX,netflix.com,ğŸ“º æµåª’ä½“',
      'DOMAIN-SUFFIX,nflxvideo.net,ğŸ“º æµåª’ä½“',

      // Disney+
      'DOMAIN-SUFFIX,disneyplus.com,ğŸ“º æµåª’ä½“',
      'DOMAIN-SUFFIX,disney-plus.net,ğŸ“º æµåª’ä½“',

      // Spotify
      'DOMAIN-SUFFIX,spotify.com,ğŸ“º æµåª’ä½“',
      'DOMAIN-SUFFIX,scdn.co,ğŸ“º æµåª’ä½“'
    );
  }

  // 3. å›½å†…ç›´è¿è§„åˆ™
  if (options?.enableChinaDirect !== false) {
    rules.push(
      // å›½å†…åŸŸå
      'DOMAIN-SUFFIX,cn,ğŸ¯ å›½å†…ç›´è¿',
      'DOMAIN-KEYWORD,baidu,ğŸ¯ å›½å†…ç›´è¿',
      'DOMAIN-KEYWORD,taobao,ğŸ¯ å›½å†…ç›´è¿',
      'DOMAIN-KEYWORD,alipay,ğŸ¯ å›½å†…ç›´è¿',

      // GeoIPä¸­å›½
      'GEOIP,CN,ğŸ¯ å›½å†…ç›´è¿'
    );
  }

  // 4. è‡ªå®šä¹‰è§„åˆ™
  if (options?.customRules && options.customRules.length > 0) {
    rules.push(...options.customRules);
  }

  // 5. å±€åŸŸç½‘ç›´è¿
  rules.push(
    'IP-CIDR,192.168.0.0/16,DIRECT',
    'IP-CIDR,10.0.0.0/8,DIRECT',
    'IP-CIDR,172.16.0.0/12,DIRECT',
    'IP-CIDR,127.0.0.0/8,DIRECT'
  );

  // 6. æœ€ç»ˆè§„åˆ™
  rules.push('MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼');

  return rules;
}
```

#### åœ°åŒºEmojiæ˜ å°„

```typescript
private getRegionEmoji(region: string): string {
  const emojiMap: Record<string, string> = {
    'é¦™æ¸¯': 'ğŸ‡­ğŸ‡°',
    'å°æ¹¾': 'ğŸ‡¨ğŸ‡³',
    'æ–°åŠ å¡': 'ğŸ‡¸ğŸ‡¬',
    'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ',
    'éŸ©å›½': 'ğŸ‡°ğŸ‡·',
    'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
    'è‹±å›½': 'ğŸ‡¬ğŸ‡§',
    'å¾·å›½': 'ğŸ‡©ğŸ‡ª',
    'æ³•å›½': 'ğŸ‡«ğŸ‡·',
    'åŠ æ‹¿å¤§': 'ğŸ‡¨ğŸ‡¦',
    'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º',
    'ä¿„ç½—æ–¯': 'ğŸ‡·ğŸ‡º',
    'å°åº¦': 'ğŸ‡®ğŸ‡³',
    'å·´è¥¿': 'ğŸ‡§ğŸ‡·',
    'åœŸè€³å…¶': 'ğŸ‡¹ğŸ‡·',
    'é˜¿æ ¹å»·': 'ğŸ‡¦ğŸ‡·',
    'å…¶ä»–': 'ğŸŒ'
  };

  return emojiMap[region] || 'ğŸŒ';
}
```

---

## ğŸ”§ CLIå‘½ä»¤è®¾è®¡

### å‘½ä»¤1: ç”ŸæˆClashé…ç½®

```bash
autosub clash:generate [options]
```

**é€‰é¡¹**:

```
--output, -o <path>      è¾“å‡ºæ–‡ä»¶è·¯å¾„ (é»˜è®¤: ~/.autosub/clash.yaml)
--test-speed             æ˜¯å¦æµ‹é€Ÿ (é»˜è®¤: true)
--concurrency <num>      æµ‹é€Ÿå¹¶å‘æ•° (é»˜è®¤: 10)
--timeout <ms>           æµ‹é€Ÿè¶…æ—¶æ—¶é—´ (é»˜è®¤: 5000ms)
--no-ai                  ç¦ç”¨AIå‘½åä¼˜åŒ–
--mode <rule|global>     Clashè¿è¡Œæ¨¡å¼ (é»˜è®¤: rule)
--port <num>             HTTPä»£ç†ç«¯å£ (é»˜è®¤: 7890)
--enable-adblock         å¯ç”¨å¹¿å‘Šæ‹¦æˆªè§„åˆ™
--enable-streaming       å¯ç”¨æµåª’ä½“åˆ†æµè§„åˆ™
```

**ç¤ºä¾‹**:

```bash
# åŸºç¡€ç”Ÿæˆ
autosub clash:generate

# è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„
autosub clash:generate -o ~/clash-config.yaml

# ç¦ç”¨æµ‹é€Ÿï¼ˆå¿«é€Ÿç”Ÿæˆï¼‰
autosub clash:generate --no-test-speed

# å¯ç”¨æ‰€æœ‰é«˜çº§åŠŸèƒ½
autosub clash:generate --enable-adblock --enable-streaming --concurrency 20
```

### å‘½ä»¤2: æµ‹é€Ÿæ‰€æœ‰èŠ‚ç‚¹

```bash
autosub clash:speedtest [options]
```

**é€‰é¡¹**:

```
--output, -o <path>      è¾“å‡ºæµ‹é€Ÿç»“æœJSON
--concurrency <num>      å¹¶å‘æ•°
--format <json|csv>      è¾“å‡ºæ ¼å¼
```

**ç¤ºä¾‹**:

```bash
# æµ‹é€Ÿå¹¶ä¿å­˜ç»“æœ
autosub clash:speedtest -o speedtest-results.json

# CSVæ ¼å¼è¾“å‡º
autosub clash:speedtest --format csv -o results.csv
```

### å‘½ä»¤3: è§£æè®¢é˜…åœ°å€

```bash
autosub clash:parse <subscription-url> [options]
```

**é€‰é¡¹**:

```
--output, -o <path>      è¾“å‡ºè§£æç»“æœ
--format <json|yaml>     è¾“å‡ºæ ¼å¼
```

**ç¤ºä¾‹**:

```bash
# è§£æå•ä¸ªè®¢é˜…åœ°å€
autosub clash:parse https://example.com/sub?token=xxx

# è¾“å‡ºä¸ºJSON
autosub clash:parse https://example.com/sub?token=xxx --format json -o nodes.json
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
AutoSub/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ subscription/
â”‚   â”‚   â”œâ”€â”€ subscription-parser.ts       # è®¢é˜…è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ node-speedtest.ts            # èŠ‚ç‚¹æµ‹é€Ÿå™¨
â”‚   â”‚   â”œâ”€â”€ node-classifier.ts           # èŠ‚ç‚¹åˆ†ç±»å™¨
â”‚   â”‚   â””â”€â”€ clash-config-generator.ts    # Clashé…ç½®ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â””â”€â”€ clash-commands.ts            # Clashç›¸å…³CLIå‘½ä»¤
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ clash.ts                     # Clashç›¸å…³ç±»å‹å®šä¹‰
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ CLASH_CONFIG_GENERATOR.md        # æœ¬æ–‡æ¡£
â””â”€â”€ test/
    â””â”€â”€ subscription/
        â”œâ”€â”€ parser.test.ts
        â”œâ”€â”€ speedtest.test.ts
        â”œâ”€â”€ classifier.test.ts
        â””â”€â”€ generator.test.ts
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

#### 1. SubscriptionParseræµ‹è¯•

```typescript
describe('SubscriptionParser', () => {
  it('åº”è¯¥æ­£ç¡®æ£€æµ‹Clash YAMLæ ¼å¼', () => {
    const parser = new SubscriptionParser();
    const format = parser['detectFormat']('proxies:\n  - name: test');
    expect(format).toBe('clash');
  });

  it('åº”è¯¥æ­£ç¡®è§£æVMess URI', () => {
    const parser = new SubscriptionParser();
    const uri = 'vmess://eyJhZGQiOiIxLjIuMy40IiwicG9ydCI6NDQzfQ==';
    const node = parser['parseVMessURI'](uri);
    expect(node.type).toBe('vmess');
    expect(node.server).toBe('1.2.3.4');
  });

  it('åº”è¯¥å¤„ç†æ ¼å¼é”™è¯¯', () => {
    const parser = new SubscriptionParser();
    expect(() => parser['parseVMessURI']('invalid')).toThrow();
  });
});
```

#### 2. NodeSpeedTesteræµ‹è¯•

```typescript
describe('NodeSpeedTester', () => {
  it('åº”è¯¥æ­£ç¡®æµ‹é€Ÿå¯ç”¨èŠ‚ç‚¹', async () => {
    const tester = new NodeSpeedTester();
    const node: ProxyNode = {
      name: 'test',
      type: 'http',
      server: '127.0.0.1',
      port: 8080
    };

    const result = await tester.testNode(node);
    expect(result.nodeName).toBe('test');
    expect(result.delay).toBeGreaterThan(0);
  });

  it('åº”è¯¥æ ‡è®°ä¸å¯ç”¨èŠ‚ç‚¹', async () => {
    const tester = new NodeSpeedTester();
    const node: ProxyNode = {
      name: 'invalid',
      type: 'http',
      server: '0.0.0.0',
      port: 1
    };

    const result = await tester.testNode(node);
    expect(result.available).toBe(false);
    expect(result.delay).toBe(-1);
  });
});
```

#### 3. NodeClassifieræµ‹è¯•

```typescript
describe('NodeClassifier', () => {
  it('åº”è¯¥æ­£ç¡®è¯†åˆ«é¦™æ¸¯èŠ‚ç‚¹', () => {
    const classifier = new NodeClassifier();
    expect(classifier['detectRegion']('é¦™æ¸¯ IPLC 01')).toBe('é¦™æ¸¯');
    expect(classifier['detectRegion']('HK-Premium')).toBe('é¦™æ¸¯');
  });

  it('åº”è¯¥æŒ‰é€Ÿåº¦åˆ†çº§', () => {
    const classifier = new NodeClassifier();
    const nodes: ProxyNode[] = [
      { name: 'fast', type: 'vmess', server: '1.1.1.1', port: 443 },
      { name: 'slow', type: 'vmess', server: '2.2.2.2', port: 443 }
    ];
    const results: SpeedTestResult[] = [
      { nodeName: 'fast', delay: 50, available: true, testTime: new Date() },
      { nodeName: 'slow', delay: 500, available: true, testTime: new Date() }
    ];

    const groups = classifier.classifyBySpeed(nodes, results);
    expect(groups.highSpeed).toHaveLength(1);
    expect(groups.lowSpeed).toHaveLength(1);
  });
});
```

### é›†æˆæµ‹è¯•

```typescript
describe('Clashé…ç½®ç”Ÿæˆå®Œæ•´æµç¨‹', () => {
  it('åº”è¯¥å®Œæ•´ç”ŸæˆClashé…ç½®', async () => {
    // 1. è§£æè®¢é˜…
    const parser = new SubscriptionParser();
    const parseResult = await parser.parse(testSubscriptionContent);

    // 2. æµ‹é€Ÿ
    const tester = new NodeSpeedTester();
    const speedResults = await tester.testNodes(parseResult.nodes);

    // 3. ç”Ÿæˆé…ç½®
    const generator = new ClashConfigGenerator();
    const config = await generator.generate(parseResult.nodes, speedResults);

    // éªŒè¯
    expect(config).toContain('proxies:');
    expect(config).toContain('proxy-groups:');
    expect(config).toContain('rules:');
  });
});
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘æ§åˆ¶

æµ‹é€Ÿæ—¶é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…ç½‘ç»œæ‹¥å µï¼š

```typescript
const concurrency = 10; // åŒæ—¶æµ‹è¯•10ä¸ªèŠ‚ç‚¹
```

### 2. ç¼“å­˜æœºåˆ¶

```typescript
// ç¼“å­˜æµ‹é€Ÿç»“æœ24å°æ—¶
const cacheKey = `speedtest:${node.name}`;
const cached = await cache.get(cacheKey);
if (cached && Date.now() - cached.time < 86400000) {
  return cached.result;
}
```

### 3. å¢é‡æ›´æ–°

ä»…æµ‹é€Ÿæ–°å¢èŠ‚ç‚¹æˆ–24å°æ—¶å†…æœªæµ‹é€Ÿçš„èŠ‚ç‚¹ã€‚

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

- è®¢é˜…åœ°å€åŒ…å«tokenï¼Œä¸è®°å½•å®Œæ•´URLåˆ°æ—¥å¿—
- ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æƒé™è®¾ä¸º`600`ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰

### 2. è¾“å…¥éªŒè¯

- éªŒè¯è®¢é˜…URLæ ¼å¼
- é™åˆ¶èŠ‚ç‚¹æ•°é‡ä¸Šé™ï¼ˆé˜²æ­¢æ¶æ„è®¢é˜…ï¼‰
- è¿‡æ»¤æ¶æ„èŠ‚ç‚¹åï¼ˆåŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼‰

---

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ: MVP (1-2å¤©)

- [x] å®ç°`SubscriptionParser`ï¼ˆæ”¯æŒClash YAML + Base64ï¼‰
- [x] å®ç°åŸºç¡€HTTPå»¶è¿Ÿæµ‹è¯•
- [x] å®ç°ç®€å•åœ°åŒºåˆ†ç±»
- [x] ç”ŸæˆåŸºç¡€Clashé…ç½®
- [x] CLIå‘½ä»¤`clash:generate`

### ç¬¬äºŒé˜¶æ®µ: å¢å¼º (3-5å¤©)

- [ ] AIèŠ‚ç‚¹å‘½åä¼˜åŒ–
- [ ] é€Ÿåº¦åˆ†çº§ä¸é«˜çº§ç­–ç•¥ç»„
- [ ] æµåª’ä½“åˆ†æµè§„åˆ™
- [ ] å®Œå–„æµ‹è¯•ç”¨ä¾‹

### ç¬¬ä¸‰é˜¶æ®µ: å¯é€‰ (æŒ‰éœ€)

- [ ] é›†æˆClash Metaæµ‹é€Ÿ
- [ ] å¸¦å®½æµ‹è¯•åŠŸèƒ½
- [ ] æµåª’ä½“è§£é”æ£€æµ‹
- [ ] è‡ªå®šä¹‰è§„åˆ™æ¨¡æ¿

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€ç”Ÿæˆ

```bash
$ autosub clash:generate

ğŸ” æ­£åœ¨è·å–è®¢é˜…åœ°å€...
âœ“ æ‰¾åˆ° 5 ä¸ªå·²é…ç½®ç«™ç‚¹

ğŸ“¥ æ­£åœ¨ä¸‹è½½è®¢é˜…å†…å®¹...
âœ“ çº¢æäº‘: 50 ä¸ªèŠ‚ç‚¹
âœ“ ç³–æœäº‘: 30 ä¸ªèŠ‚ç‚¹
âœ“ ç‰›é€¼æœºåœº: 45 ä¸ªèŠ‚ç‚¹
âœ“ ä¼˜é€Ÿé€š: 25 ä¸ªèŠ‚ç‚¹
âœ“ ç«çƒ§äº‘: 35 ä¸ªèŠ‚ç‚¹

âš¡ æ­£åœ¨æµ‹é€Ÿ 185 ä¸ªèŠ‚ç‚¹ (å¹¶å‘: 10)...
æµ‹é€Ÿè¿›åº¦: 10/185 (5%)
æµ‹é€Ÿè¿›åº¦: 20/185 (11%)
...
æµ‹é€Ÿè¿›åº¦: 185/185 (100%)
âœ“ æµ‹é€Ÿå®Œæˆ: 165 ä¸ªå¯ç”¨èŠ‚ç‚¹

ğŸ”§ æ­£åœ¨ç”ŸæˆClashé…ç½®...
âœ“ åœ°åŒºåˆ†ç±»: é¦™æ¸¯(50) æ–°åŠ å¡(30) ç¾å›½(40) æ—¥æœ¬(25) å…¶ä»–(20)
âœ“ é€Ÿåº¦åˆ†çº§: é«˜é€Ÿ(80) ä¸­é€Ÿ(65) ä½é€Ÿ(20)
âœ“ ç­–ç•¥ç»„ç”Ÿæˆå®Œæˆ
âœ“ è§„åˆ™é›†ç”Ÿæˆå®Œæˆ

ğŸ’¾ é…ç½®å·²ä¿å­˜åˆ°: /Users/engtyleong/.autosub/clash.yaml

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
  æ€»èŠ‚ç‚¹æ•°: 185
  å¯ç”¨èŠ‚ç‚¹: 165 (89.2%)
  é«˜é€ŸèŠ‚ç‚¹: 80 (48.5%)
  ç­–ç•¥ç»„æ•°: 12
  è§„åˆ™æ•°: 45
```

### ç¤ºä¾‹2: è‡ªå®šä¹‰é…ç½®

```bash
$ autosub clash:generate \
  --output ~/clash-premium.yaml \
  --enable-adblock \
  --enable-streaming \
  --concurrency 20 \
  --port 7891

âœ“ é…ç½®å·²ç”Ÿæˆ: ~/clash-premium.yaml
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: æµ‹é€Ÿå…¨éƒ¨å¤±è´¥

**å¯èƒ½åŸå› **:
- ç½‘ç»œè¿æ¥é—®é¢˜
- èŠ‚ç‚¹åè®®ä¸æ”¯æŒç›´æ¥æµ‹é€Ÿ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨Clash Metaæµ‹é€Ÿ
autosub clash:generate --use-clash-meta
```

### é—®é¢˜2: è§£æå¤±è´¥

**å¯èƒ½åŸå› **: è®¢é˜…æ ¼å¼ä¸æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
autosub clash:parse <url> --debug
```

### é—®é¢˜3: ç”Ÿæˆçš„é…ç½®æ— æ³•ä½¿ç”¨

**å¯èƒ½åŸå› **:
- èŠ‚ç‚¹æ ¼å¼é”™è¯¯
- ç¼ºå°‘å¿…è¦å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ—¥å¿—ä¸­çš„è­¦å‘Šä¿¡æ¯
- ä½¿ç”¨`--verbose`æŸ¥çœ‹è¯¦ç»†è¿‡ç¨‹

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å¼€æºé¡¹ç›®

- [tindy2013/subconverter](https://github.com/tindy2013/subconverter) - C++ è®¢é˜…è½¬æ¢å™¨
- [SubConv/SubConv](https://github.com/SubConv/SubConv) - Python è®¢é˜…è½¬æ¢å™¨
- [xiecang/speedtest-clash](https://github.com/xiecang/speedtest-clash) - Go æµ‹é€Ÿå·¥å…·
- [starudream/clash-speedtest](https://github.com/starudream/clash-speedtest) - Go æµ‹é€Ÿå·¥å…·

### æŠ€æœ¯æ–‡æ¡£

- [Clash é…ç½®æ–‡æ¡£](https://github.com/Dreamacro/clash/wiki/configuration)
- [Clash Meta æ–‡æ¡£](https://wiki.metacubex.one/)
- [VMess åè®®è§„èŒƒ](https://www.v2fly.org/config/protocols/vmess.html)
- [Trojan åè®®è§„èŒƒ](https://trojan-gfw.github.io/trojan/protocol)

---

## âœ… éªŒæ”¶æ ‡å‡†

1. âœ… æ”¯æŒè‡³å°‘3ç§è®¢é˜…æ ¼å¼ï¼ˆClash YAML / Base64 / V2Ray JSONï¼‰
2. âœ… èŠ‚ç‚¹æµ‹é€Ÿå‡†ç¡®ç‡ > 95%
3. âœ… åœ°åŒºè¯†åˆ«å‡†ç¡®ç‡ > 90%
4. âœ… ç”Ÿæˆçš„é…ç½®å¯ç›´æ¥åœ¨Clashä¸­ä½¿ç”¨
5. âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
6. âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
7. âœ… æ–‡æ¡£å®Œæ•´ï¼ˆåŒ…æ‹¬APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—ï¼‰

---

## ğŸ“… ç‰ˆæœ¬è§„åˆ’

### v1.0.0 (MVP)
- åŸºç¡€è®¢é˜…è§£æ
- HTTPå»¶è¿Ÿæµ‹è¯•
- ç®€å•é…ç½®ç”Ÿæˆ

### v1.1.0
- AIå‘½åä¼˜åŒ–
- é«˜çº§ç­–ç•¥ç»„
- æµåª’ä½“è§„åˆ™

### v1.2.0
- Clash Metaé›†æˆ
- å¸¦å®½æµ‹é€Ÿ
- è‡ªå®šä¹‰æ¨¡æ¿

### v2.0.0
- Web UIç•Œé¢
- è®¢é˜…ç®¡ç†å™¨
- è‡ªåŠ¨æ›´æ–°é…ç½®

---

## ğŸ‘¥ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AutoSub Team
**æœ€åæ›´æ–°**: 2025-01-04
**çŠ¶æ€**: ğŸŸ¢ Active Development
