# v1.3.1 æœ¬åœ°æµ‹è¯•æŒ‡å—

## å¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼‰

```bash
./test-local.sh
```

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ„å»ºé¡¹ç›®
2. åˆ›å»ºå…¨å±€é“¾æ¥
3. æä¾›æµ‹è¯•é€‰é¡¹èœå•

## æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: æ„å»ºå¹¶å®‰è£…åˆ°å…¨å±€

```bash
# æ„å»ºé¡¹ç›®
npm run build

# åˆ›å»ºå…¨å±€é“¾æ¥
npm link
```

### æ­¥éª¤2: æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½

#### ğŸ¯ é‡ç‚¹æµ‹è¯•ï¼šCookieè¿‡æœŸè‡ªåŠ¨åˆ·æ–°

è¿™æ˜¯v1.3.1çš„æ ¸å¿ƒæ”¹è¿›åŠŸèƒ½ã€‚

**æµ‹è¯•æ–¹æ³•ï¼š**

```bash
# æ–¹å¼1: ä½¿ç”¨é™é»˜æ¨¡å¼æ›´æ–°æ‰€æœ‰ç«™ç‚¹
autosub update --all --silent

# æ–¹å¼2: ä½¿ç”¨äº¤äº’èœå•ï¼ˆé€‰æ‹©"4. æ›´æ–°è®¢é˜… -> 1. æ›´æ–°æ‰€æœ‰ç«™ç‚¹"ï¼‰
autosub
```

**é¢„æœŸè¡Œä¸ºï¼š**

å¦‚æœCookieå·²è¿‡æœŸï¼š
```
[INFO] æ£€æµ‹åˆ°APIé…ç½®ï¼Œå°è¯•é™é»˜HTTPæå–...
[INFO] API å“åº”çŠ¶æ€: 403
[INFO] API å“åº”æ•°æ®: {"status": "fail", "message": "æœªç™»å½•æˆ–ç™»é™†å·²è¿‡æœŸ", ...}
[WARN] æ£€æµ‹åˆ°Cookieå·²è¿‡æœŸï¼Œå°è¯•è‡ªåŠ¨åˆ·æ–°...
[INFO] æ­£åœ¨ä¸º çº¢æäº‘ è‡ªåŠ¨åˆ·æ–°Cookieï¼ˆheadlessæ¨¡å¼ï¼‰...
[INFO] âœ“ Cookieåˆ·æ–°æˆåŠŸ
[INFO] Cookieåˆ·æ–°æˆåŠŸï¼Œé‡è¯•HTTP APIæå–...
[INFO] âœ“ HTTP APIé™é»˜æå–æˆåŠŸï¼ˆåˆ·æ–°åï¼‰
```

å¦‚æœCookieæœ‰æ•ˆï¼š
```
[INFO] æ£€æµ‹åˆ°APIé…ç½®ï¼Œå°è¯•é™é»˜HTTPæå–...
[INFO] API å“åº”çŠ¶æ€: 200
[INFO] âœ“ HTTP APIé™é»˜æå–æˆåŠŸ
```

#### å…¶ä»–åŠŸèƒ½æµ‹è¯•

```bash
# 1. æŸ¥çœ‹ç«™ç‚¹çŠ¶æ€
autosub status

# 2. æµ‹è¯•å•ä¸ªç«™ç‚¹æ›´æ–°
autosub update <ç«™ç‚¹ID> --silent

# 3. æ‰‹åŠ¨åˆ·æ–°Cookieï¼ˆheadlessæ¨¡å¼ï¼‰
autosub refresh-credentials --headless --all

# 4. æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
autosub --help
autosub update --help
```

### æ­¥éª¤3: éªŒè¯é”™è¯¯å¤„ç†

#### æµ‹è¯•åœºæ™¯1: Cookieè¿‡æœŸä¸”æ— æ³•åˆ·æ–°

å¦‚æœç«™ç‚¹æ— æ³•è®¿é—®æˆ–ç™»å½•é¡µé¢ç»“æ„å˜åŒ–ï¼š

**é¢„æœŸè¾“å‡ºï¼š**
```
[ERROR] è‡ªåŠ¨åˆ·æ–°Cookieå¤±è´¥
âŒ æ›´æ–°å¤±è´¥: Cookieå·²è¿‡æœŸä¸”è‡ªåŠ¨åˆ·æ–°å¤±è´¥: [å…·ä½“é”™è¯¯ä¿¡æ¯]
```

#### æµ‹è¯•åœºæ™¯2: ç¼ºå°‘å‡­è¯æ–‡ä»¶

åˆ é™¤æŸä¸ªç«™ç‚¹çš„å‡­è¯æ–‡ä»¶åæµ‹è¯•ï¼š

```bash
rm ~/.autosub/credentials/<ç«™ç‚¹ID>.json
autosub update <ç«™ç‚¹ID> --silent
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âŒ æ›´æ–°å¤±è´¥: ç¼ºå°‘å‡­è¯æ–‡ä»¶ï¼Œé™é»˜æ¨¡å¼ä¸‹æ— æ³•é‡æ–°è·å–ã€‚è¯·è¿è¡Œ: autosub refresh-credentials --headless
```

#### æµ‹è¯•åœºæ™¯3: è®¢é˜…åœ°å€æ— æ•ˆ

**é¢„æœŸè¾“å‡ºï¼š**
```
âŒ æ›´æ–°å¤±è´¥: å·²ä¿å­˜çš„è®¢é˜…åœ°å€æ— æ•ˆï¼Œé™é»˜æ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨æµè§ˆå™¨é‡æ–°è·å–ã€‚è¯·è¿è¡Œ: autosub add é‡æ–°é…ç½®ç«™ç‚¹
```

### æ­¥éª¤4: æµ‹è¯•å®Œæˆåæ¸…ç†

```bash
# å–æ¶ˆå…¨å±€é“¾æ¥
npm unlink -g clash-autosub
```

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š`~/.autosub/logs/`

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f ~/.autosub/logs/autosub-$(date +%Y-%m-%d).log

# æˆ–è€…ä½¿ç”¨lessæŸ¥çœ‹
less ~/.autosub/logs/autosub-$(date +%Y-%m-%d).log
```

### æ‰‹åŠ¨è§¦å‘Cookieè¿‡æœŸæµ‹è¯•

å¦‚æœæƒ³å¼ºåˆ¶æµ‹è¯•Cookieè¿‡æœŸåœºæ™¯ï¼š

1. å¤‡ä»½å½“å‰å‡­è¯ï¼š
```bash
cp ~/.autosub/credentials/<ç«™ç‚¹ID>.json ~/.autosub/credentials/<ç«™ç‚¹ID>.json.bak
```

2. ä¿®æ”¹Cookieè¿‡æœŸæ—¶é—´ï¼ˆä½¿å…¶ç«‹å³è¿‡æœŸï¼‰ï¼š
```bash
# ç¼–è¾‘å‡­è¯æ–‡ä»¶ï¼Œå°†æ‰€æœ‰cookieçš„expireså­—æ®µæ”¹ä¸ºè¿‡å»çš„æ—¶é—´æˆ³
# ä¾‹å¦‚ï¼šå°† 1735747200 æ”¹ä¸º 1000000000
```

3. è¿è¡Œæµ‹è¯•ï¼š
```bash
autosub update <ç«™ç‚¹ID> --silent
```

4. æ¢å¤å‡­è¯ï¼š
```bash
mv ~/.autosub/credentials/<ç«™ç‚¹ID>.json.bak ~/.autosub/credentials/<ç«™ç‚¹ID>.json
```

## æˆåŠŸæ ‡å‡†

âœ… **v1.3.1æµ‹è¯•é€šè¿‡æ ‡å‡†ï¼š**

1. Cookieæœ‰æ•ˆæ—¶ï¼Œé™é»˜æ›´æ–°ç›´æ¥æˆåŠŸï¼ˆ< 2ç§’å®Œæˆï¼‰
2. Cookieè¿‡æœŸæ—¶ï¼Œè‡ªåŠ¨è§¦å‘headlessåˆ·æ–°ï¼Œç„¶åæ›´æ–°æˆåŠŸ
3. Cookieåˆ·æ–°å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆ
4. ç¼ºå°‘å‡­è¯æ—¶ï¼Œæ˜¾ç¤ºæ­£ç¡®çš„CLIå‘½ä»¤æç¤º
5. è®¢é˜…åœ°å€æ— æ•ˆæ—¶ï¼Œæç¤ºé‡æ–°é…ç½®ç«™ç‚¹
6. æ—¥å¿—è¾“å‡ºæ¸…æ™°ï¼Œèƒ½å¤Ÿè¿½è¸ªæ•´ä¸ªæµç¨‹
7. ä¸ä¼šå¼¹å‡ºæµè§ˆå™¨çª—å£ï¼ˆheadlessæ¨¡å¼ï¼‰

## å›å½’æµ‹è¯•

ç¡®ä¿v1.3.1æ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½ï¼š

```bash
# 1. æ ‡å‡†æ¨¡å¼ï¼ˆéé™é»˜ï¼‰ä»ç„¶æ­£å¸¸å·¥ä½œ
autosub update --all

# 2. äº¤äº’èœå•æ‰€æœ‰é€‰é¡¹æ­£å¸¸
autosub

# 3. æ·»åŠ æ–°ç«™ç‚¹åŠŸèƒ½æ­£å¸¸
autosub add

# 4. æŸ¥çœ‹é…ç½®åŠŸèƒ½æ­£å¸¸
autosub config

# 5. æ‰‹åŠ¨åˆ·æ–°CookieåŠŸèƒ½æ­£å¸¸ï¼ˆæœ‰å¤´æ¨¡å¼ï¼‰
autosub refresh-credentials --all
```

## å¸¸è§é—®é¢˜

### Q: npm linkå¤±è´¥
```bash
# å¯èƒ½éœ€è¦sudoæƒé™
sudo npm link
```

### Q: å‘½ä»¤æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥å…¨å±€node_modulesè·¯å¾„
npm config get prefix

# ç¡®ä¿è¯¥è·¯å¾„åœ¨ä½ çš„PATHä¸­
echo $PATH
```

### Q: æƒ³ç›´æ¥æµ‹è¯•ä¸å®‰è£…
```bash
# ä½¿ç”¨nodeç›´æ¥è¿è¡Œ
node dist/index.js update --all --silent

# æˆ–ä½¿ç”¨tsxè¿è¡Œæºç ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
npx tsx src/cli/index.ts update --all --silent
```
